
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badminton League Tracker - Spring 2026</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 2px solid #e0e0e0; }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; font-weight: 600; transition: all 0.3s; border: none; background: transparent; font-size: 1em; }
        .tab:hover { background: #e9ecef; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        .setup-section { background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #667eea; }
        .setup-section h3 { color: #667eea; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #333; }
        .form-group input { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; }
        .form-group input:focus { outline: none; border-color: #667eea; }
        .teams-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .team-box { background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; }
        .team-box h4 { color: #667eea; margin-bottom: 15px; }
        .player-input { margin-bottom: 10px; }
        .schedule-wrapper { background: white; padding: 20px; border-radius: 8px; border: 2px solid #667eea; }
        .schedule-header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 15px; }
        .schedule-header h2 { margin: 0; font-size: 24px; color: #333; }
        .schedule-header h3 { margin: 5px 0 0 0; font-size: 16px; color: #666; font-weight: normal; }
        .teams-legend { margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; }
        .teams-legend h3 { margin: 0 0 10px 0; color: #333; font-size: 16px; }
        .team-list { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .team-item { padding: 8px 10px; background: white; border-radius: 4px; border-left: 3px solid #667eea; font-size: 12px; }
        .team-name { font-weight: bold; margin-bottom: 3px; color: #667eea; }
        .players { font-size: 11px; color: #666; }
        .games-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .rivalry-section { margin-bottom: 15px; }
        .rivalry-title { background: #667eea; color: white; padding: 8px 12px; margin-bottom: 8px; font-weight: bold; font-size: 13px; border-radius: 4px; }
        .game-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; margin-bottom: 4px; border: 1px solid #ddd; background: white; font-size: 12px; border-radius: 4px; }
        .game-row:hover { background: #f8f9fa; }
        .game-info { flex: 1; display: flex; align-items: center; }
        .game-number { font-weight: bold; margin-right: 10px; min-width: 60px; color: #333; }
        .matchup { font-size: 12px; }
        .vs { margin: 0 8px; font-weight: bold; color: #666; }
        .team { font-weight: 600; }
        .score-section { display: flex; align-items: center; min-width: 100px; }
        .score-label { font-size: 11px; color: #666; margin-right: 8px; font-weight: 500; }
        .score-input { width: 35px; height: 28px; border: 2px solid #667eea; margin: 0 4px; text-align: center; font-size: 13px; border-radius: 4px; font-weight: 600; }
        .score-input:focus { outline: none; border-color: #764ba2; background: #f0f4ff; }
        .score-input.has-value { background: #e8f5e9; border-color: #28a745; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #333; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-sm { padding: 8px 16px; font-size: 0.9em; }
        .action-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .results-section { margin-top: 20px; padding: 20px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #28a745; display: none; }
        .results-section h3 { margin: 0 0 15px 0; color: #155724; }
        .result-item { margin-bottom: 10px; padding: 10px; background: white; border-radius: 4px; border-left: 3px solid #28a745; }
        .leaderboard { background: white; border-radius: 12px; }
        .leaderboard-item { display: grid; grid-template-columns: 60px 1fr 90px 90px 90px 100px; padding: 15px 20px; border-bottom: 1px solid #e0e0e0; align-items: center; }
        .leaderboard-item:hover { background: #f8f9fa; }
        .leaderboard-item.header { background: #667eea; color: white; font-weight: 600; border-radius: 12px 12px 0 0; }
        .rank { font-size: 1.5em; font-weight: 700; color: #667eea; }
        .leaderboard-item.header .rank { color: white; font-size: 1em; }
        .rank.gold { color: #FFD700; }
        .rank.silver { color: #C0C0C0; }
        .rank.bronze { color: #CD7F32; }
        .player-name { font-weight: 600; font-size: 1.7em; }
        .leaderboard-item.header .player-name { font-size: 1em; }
        .stat { text-align: center; font-weight: 600; }
        .week-section { margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 12px; }
        .week-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #667eea; }
        .week-header h3 { color: #667eea; }
        .week-actions { display: flex; gap: 10px; }
        .empty-state { text-align: center; padding: 60px 20px; color: #6c757d; }
        .empty-state h3 { margin-bottom: 10px; }
        .export-buttons { display: flex; gap: 10px; margin-bottom: 20px; }
        .edit-mode { background: #fff3cd; border-left-color: #ffc107; }
        .edit-mode .rivalry-title { background: #ffc107; color: #333; }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; border-radius: 0; }
            .header, .tabs, .action-buttons, .export-buttons, .week-actions, .results-section { display: none !important; }
            .tab-content { display: block !important; padding: 10px; }
            .schedule-wrapper { border: none; padding: 10px; }
            .score-input { width: 55px !important; height: 45px !important; border: 3px solid #000 !important; font-size: 18px !important; background: white !important; font-weight: bold !important; }
            .game-row { padding: 12px; margin-bottom: 8px; }
            .score-section { min-width: 150px; }
            .matchup { font-size: 14px !important; }
            .team { font-size: 14px !important; font-weight: 700 !important; }
            .game-number { font-size: 14px !important; }
            .rivalry-title { font-size: 15px !important; padding: 10px 12px !important; }
            .team-name { font-size: 14px !important; }
            .players { font-size: 13px !important; }
            @page { size: landscape; margin: 0.5in; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∏ Badminton League Tracker</h1>
            <p>Spring 2026 Season | Ends June 30, 2026</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('setup')">Setup Friday</button>
            <button class="tab" onclick="switchTab('record')">Record Scores</button>
            <button class="tab" onclick="switchTab('leaderboard')">Leaderboard</button>
            <button class="tab" onclick="switchTab('history')">History</button>
        </div>

        <div id="setup" class="tab-content active">
            <h2 style="margin-bottom: 20px;">Setup This Friday's Teams</h2>
            <div class="setup-section">
                <h3>üìÖ Date</h3>
                <div class="form-group"><label>Select Date:</label><input type="date" id="fridayDate"></div>
            </div>
            <div class="setup-section">
                <h3>üèüÔ∏è Courts</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group"><label>Court 1:</label><input type="text" id="court1" value="Court 1"></div>
                    <div class="form-group"><label>Court 2:</label><input type="text" id="court2" value="Court 2"></div>
                </div>
            </div>
            <div class="setup-section">
                <h3>üë• Teams (12 Players ‚Üí 4 Teams)</h3>
                <div class="teams-grid">
                    <div class="team-box">
                        <h4>Team 1</h4>
                        <div class="form-group"><label>Team Name:</label><input type="text" id="t1n" placeholder="Team 1"></div>
                        <div class="player-input"><input type="text" id="t1p1" placeholder="Player 1"></div>
                        <div class="player-input"><input type="text" id="t1p2" placeholder="Player 2"></div>
                        <div class="player-input"><input type="text" id="t1p3" placeholder="Player 3"></div>
                    </div>
                    <div class="team-box">
                        <h4>Team 2</h4>
                        <div class="form-group"><label>Team Name:</label><input type="text" id="t2n" placeholder="Team 2"></div>
                        <div class="player-input"><input type="text" id="t2p1" placeholder="Player 1"></div>
                        <div class="player-input"><input type="text" id="t2p2" placeholder="Player 2"></div>
                        <div class="player-input"><input type="text" id="t2p3" placeholder="Player 3"></div>
                    </div>
                    <div class="team-box">
                        <h4>Team 3</h4>
                        <div class="form-group"><label>Team Name:</label><input type="text" id="t3n" placeholder="Team 3"></div>
                        <div class="player-input"><input type="text" id="t3p1" placeholder="Player 1"></div>
                        <div class="player-input"><input type="text" id="t3p2" placeholder="Player 2"></div>
                        <div class="player-input"><input type="text" id="t3p3" placeholder="Player 3"></div>
                    </div>
                    <div class="team-box">
                        <h4>Team 4</h4>
                        <div class="form-group"><label>Team Name:</label><input type="text" id="t4n" placeholder="Team 4"></div>
                        <div class="player-input"><input type="text" id="t4p1" placeholder="Player 1"></div>
                        <div class="player-input"><input type="text" id="t4p2" placeholder="Player 2"></div>
                        
                        <div class="player-input"><input type="text" id="t4p3" placeholder="Player 3"></div>
                    </div>
                </div>
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="genSched()">üè∏ Generate Schedule</button>
        </div>

        <div id="record" class="tab-content">
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="switchTab('setup')">‚Üê Back</button>
                <button class="btn btn-info" onclick="window.print()">üñ®Ô∏è Print</button>
                <button class="btn btn-success" onclick="calcResults()">üèÜ Calculate Results</button>
                <button class="btn btn-danger" onclick="clearScores()">üóëÔ∏è Clear</button>
                <button class="btn btn-primary" onclick="saveWeek()">üíæ Save Week</button>
            </div>
            <div id="schedCont"><div class="empty-state"><h3>No schedule yet</h3><p>Setup teams first!</p></div></div>
            <div id="resultsSection" class="results-section"></div>
        </div>

        <div id="leaderboard" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üèÜ Season Leaderboard</h2>
                <div class="export-buttons">
                    <button class="btn btn-success" onclick="exportCSV()">üìä CSV</button>
                    <button class="btn btn-secondary" onclick="copyClip()">üìã Copy</button>
                </div>
            </div>
            <div class="leaderboard" id="lbCont">
                <div class="leaderboard-item header">
                    <div class="rank">Rank</div><div class="player-name">Player</div><div class="stat">Matches</div><div class="stat">Wins</div><div class="stat">Points</div><div class="stat">Pts/Match</div>
                </div>
                <div class="empty-state"><h3>No data yet</h3></div>
            </div>
        </div>

        <div id="history" class="tab-content">
            <h2 style="margin-bottom: 20px;">üìÖ Season History</h2>
            <div id="histCont"><div class="empty-state"><h3>No history yet</h3></div></div>
        </div>
    </div>

    <script>
        var data={weeks:[],players:{}},curr=null,editIdx=null;
        function load(){var s=localStorage.getItem('bmt26');if(s){data=JSON.parse(s);updLB();updHist();}}
        function save(){localStorage.setItem('bmt26',JSON.stringify(data));}
        document.getElementById('fridayDate').valueAsDate=new Date();
        function switchTab(n){var t=document.querySelectorAll('.tab-content');for(var i=0;i<t.length;i++)t[i].classList.remove('active');var b=document.querySelectorAll('.tab');for(var i=0;i<b.length;i++)b[i].classList.remove('active');document.getElementById(n).classList.add('active');event.target.classList.add('active');if(n==='leaderboard')updLB();else if(n==='history')updHist();}
        function genSched(){var d=document.getElementById('fridayDate').value;if(!d){alert('Select date!');return;}var c1=document.getElementById('court1').value||'Court 1',c2=document.getElementById('court2').value||'Court 2',ts=[];for(var i=1;i<=4;i++){var n=document.getElementById('t'+i+'n').value.trim(),p1=document.getElementById('t'+i+'p1').value.trim(),p2=document.getElementById('t'+i+'p2').value.trim(),p3=document.getElementById('t'+i+'p3').value.trim();if(!n||!p1||!p2||!p3){alert('Fill Team '+i+'!');return;}ts.push({name:n,players:[p1,p2,p3]});}curr={date:d,court1:c1,court2:c2,teams:ts,matches:[]};editIdx=null;dispSched(d,c1,c2,ts,null);switchTab('record');}
        function dispSched(d,c1,c2,ts,ex){var c=document.getElementById('schedCont');function gm(t1,t2){var p1=[[t1.players[0],t1.players[1]],[t1.players[0],t1.players[2]],[t1.players[1],t1.players[2]]],p2=[[t2.players[0],t2.players[1]],[t2.players[0],t2.players[2]],[t2.players[1],t2.players[2]]],m=[];for(var i=0;i<3;i++)m.push({t1n:t1.name,t2n:t2.name,t1p:p1[i],t2p:p2[i]});return m;}var rv=[{teams:[ts[0],ts[1]],court:c1},{teams:[ts[2],ts[3]],court:c2},{teams:[ts[3],ts[1]],court:c1},{teams:[ts[0],ts[2]],court:c2},{teams:[ts[3],ts[0]],court:c1},{teams:[ts[2],ts[1]],court:c2}],gn=1,lc='',rc='',am=[];for(var r=0;r<rv.length;r++){var ms=gm(rv[r].teams[0],rv[r].teams[1]),rh='<div class="rivalry-section'+(editIdx!==null?' edit-mode':'')+'"><div class="rivalry-title">'+rv[r].court+' - '+rv[r].teams[0].name+' vs '+rv[r].teams[1].name+'</div>';for(var m=0;m<ms.length;m++){var mt=ms[m];am.push(mt);var s1=ex&&ex[gn-1]?ex[gn-1].score1:'',s2=ex&&ex[gn-1]?ex[gn-1].score2:'';rh+='<div class="game-row"><div class="game-info"><div class="game-number">Game '+gn+':</div><div class="matchup"><span class="team">'+mt.t1p[0]+' & '+mt.t1p[1]+'</span><span class="vs">vs</span><span class="team">'+mt.t2p[0]+' & '+mt.t2p[1]+'</span></div></div><div class="score-section"><span class="score-label">Score:</span><input type="number" id="g'+gn+'s1" class="score-input'+(s1?' has-value':'')+'" min="0" max="99" placeholder="0" value="'+s1+'" onchange="this.classList.toggle(\'has-value\',this.value!==\'\')"><input type="number" id="g'+gn+'s2" class="score-input'+(s2?' has-value':'')+'" min="0" max="99" placeholder="0" value="'+s2+'" onchange="this.classList.toggle(\'has-value\',this.value!==\'\')"></div></div>';gn++;}rh+='</div>';if(r%2===0)lc+=rh;else rc+=rh;}curr.matches=am;var dt=new Date(d).toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'}),eb=editIdx!==null?'<div style="background:#fff3cd;padding:15px;margin-bottom:20px;border-radius:8px;border-left:4px solid #ffc107;"><strong>‚ö†Ô∏è EDIT MODE</strong></div>':'',h=eb+'<div class="schedule-wrapper"><div class="schedule-header"><h2>üè∏ '+dt+'</h2><h3>18-Game Schedule</h3></div><div class="teams-legend"><h3>üë• Teams</h3><div class="team-list">';for(var t=0;t<ts.length;t++)h+='<div class="team-item"><div class="team-name">'+ts[t].name+'</div><div class="players">'+ts[t].players.join(', ')+'</div></div>';h+='</div></div><div class="games-container"><div class="left-column">'+lc+'</div><div class="right-column">'+rc+'</div></div></div>';c.innerHTML=h;}
        function calcResults(){if(!curr){alert('Generate schedule first!');return;}var tStats={},pStats={};for(var i=0;i<curr.teams.length;i++)tStats[curr.teams[i].name]={wins:0,losses:0,ptsFor:0,ptsAgainst:0,diff:0};var cnt=0;for(var i=0;i<curr.matches.length;i++){var gn=i+1,s1i=document.getElementById('g'+gn+'s1'),s2i=document.getElementById('g'+gn+'s2');if(s1i&&s2i&&s1i.value&&s2i.value){var s1=parseInt(s1i.value),s2=parseInt(s2i.value),mt=curr.matches[i],w=s1>s2?mt.t1n:mt.t2n,l=s1>s2?mt.t2n:mt.t1n;tStats[mt.t1n].ptsFor+=s1;tStats[mt.t1n].ptsAgainst+=s2;tStats[mt.t2n].ptsFor+=s2;tStats[mt.t2n].ptsAgainst+=s1;if(s1>s2){tStats[w].wins++;tStats[l].losses++;}else if(s2>s1){tStats[w].wins++;tStats[l].losses++;}var p1=mt.t1p[0]+' & '+mt.t1p[1],p2=mt.t2p[0]+' & '+mt.t2p[1];if(!pStats[p1])pStats[p1]={wins:0,losses:0,ptsFor:0,ptsAgainst:0,team:mt.t1n};if(!pStats[p2])pStats[p2]={wins:0,losses:0,ptsFor:0,ptsAgainst:0,team:mt.t2n};if(s1>s2){pStats[p1].wins++;pStats[p1].ptsFor+=s1;pStats[p1].ptsAgainst+=s2;pStats[p2].losses++;pStats[p2].ptsFor+=s2;pStats[p2].ptsAgainst+=s1;}else{pStats[p2].wins++;pStats[p2].ptsFor+=s2;pStats[p2].ptsAgainst+=s1;pStats[p1].losses++;pStats[p1].ptsFor+=s1;pStats[p1].ptsAgainst+=s2;}cnt++;}}if(cnt===0){alert('Enter scores first!');return;}for(var t in tStats)tStats[t].diff=tStats[t].ptsFor-tStats[t].ptsAgainst;var tRes=Object.entries(tStats).map(function(e){return{team:e[0],wins:e[1].wins,losses:e[1].losses,ptsFor:e[1].ptsFor,ptsAgainst:e[1].ptsAgainst,diff:e[1].diff};}).sort(function(a,b){return b.wins-a.wins||b.diff-a.diff||b.ptsFor-a.ptsFor;}),pRes=Object.entries(pStats).map(function(e){return{pair:e[0],wins:e[1].wins,losses:e[1].losses,ptsFor:e[1].ptsFor,ptsAgainst:e[1].ptsAgainst,diff:e[1].ptsFor-e[1].ptsAgainst,team:e[1].team};}).sort(function(a,b){return b.wins-a.wins||b.diff-a.diff;}),bp=pRes.filter(function(p){return p.wins>0;}).slice(0,3),dp=pRes.filter(function(p){return p.ptsAgainst>0;}).sort(function(a,b){return a.ptsAgainst-b.ptsAgainst;}).slice(0,2);var h='<h3>üèÜ This Week\'s Results</h3>';h+='<div class="result-item"><strong>üìä Games Completed:</strong> '+cnt+' of 18</div>';h+='<div class="result-item"><strong>üèÜ Week Winner:</strong> '+tRes[0].team+' ('+tRes[0].wins+'W-'+tRes[0].losses+'L, '+(tRes[0].diff>0?'+':'')+tRes[0].diff+' diff)</div>';h+='<div class="result-item"><strong>üìä Team Standings:</strong><br>';for(var i=0;i<tRes.length;i++)h+=(i+1)+'. '+tRes[i].team+': '+tRes[i].wins+'W-'+tRes[i].losses+'L, '+(tRes[i].diff>0?'+':'')+tRes[i].diff+' diff ('+tRes[i].ptsFor+' for, '+tRes[i].ptsAgainst+' against)<br>';h+='</div>';if(bp.length>0){h+='<div class="result-item"><strong>‚≠ê Best Pairs (Most Wins):</strong><br>';for(var i=0;i<bp.length;i++)h+=(i+1)+'. '+bp[i].pair+' ('+bp[i].team+'): '+bp[i].wins+'W-'+bp[i].losses+'L, '+(bp[i].diff>0?'+':'')+bp[i].diff+' diff<br>';h+='</div>';}if(dp.length>0){h+='<div class="result-item"><strong>üéØ Best Defense (Fewest Points Against):</strong><br>';for(var i=0;i<dp.length;i++)h+=(i+1)+'. '+dp[i].pair+' ('+dp[i].team+'): '+dp[i].ptsAgainst+' pts against<br>';h+='</div>';}document.getElementById('resultsSection').innerHTML=h;document.getElementById('resultsSection').style.display='block';document.getElementById('resultsSection').scrollIntoView({behavior:'smooth',block:'nearest'});}
        function clearScores(){if(confirm('Clear all scores?')){for(var i=1;i<=18;i++){var s1=document.getElementById('g'+i+'s1'),s2=document.getElementById('g'+i+'s2');if(s1&&s2){s1.value='';s2.value='';s1.classList.remove('has-value');s2.classList.remove('has-value');}}document.getElementById('resultsSection').style.display='none';}}
        function editWeek(wi){var w=data.weeks[wi];document.getElementById('fridayDate').value=w.date;document.getElementById('court1').value=w.court1;document.getElementById('court2').value=w.court2;for(var i=0;i<w.teams.length;i++){var t=w.teams[i];document.getElementById('t'+(i+1)+'n').value=t.name;document.getElementById('t'+(i+1)+'p1').value=t.players[0];document.getElementById('t'+(i+1)+'p2').value=t.players[1];document.getElementById('t'+(i+1)+'p3').value=t.players[2];}curr={date:w.date,court1:w.court1,court2:w.court2,teams:w.teams,matches:[]};editIdx=wi;dispSched(w.date,w.court1,w.court2,w.teams,w.matches);switchTab('record');}
        function delWeek(wi){if(confirm('Delete week?')){data.weeks.splice(wi,1);recalc();save();updLB();updHist();alert('‚úÖ Deleted!');}}
        function recalc(){data.players={};for(var w=0;w<data.weeks.length;w++){var wk=data.weeks[w];for(var m=0;m<wk.matches.length;m++){var mt=wk.matches[m];updPS(mt.t1p[0],mt.score1,mt.score2);updPS(mt.t1p[1],mt.score1,mt.score2);updPS(mt.t2p[0],mt.score2,mt.score1);updPS(mt.t2p[1],mt.score2,mt.score1);}}}
        function saveWeek(){if(!curr){alert('Generate schedule first!');return;}var wm=[],cnt=0;for(var i=0;i<curr.matches.length;i++){var mt=curr.matches[i],gn=i+1,s1i=document.getElementById('g'+gn+'s1'),s2i=document.getElementById('g'+gn+'s2');if(s1i&&s2i&&s1i.value&&s2i.value){var s1=parseInt(s1i.value),s2=parseInt(s2i.value);wm.push({gameNumber:gn,t1n:mt.t1n,t2n:mt.t2n,t1p:mt.t1p,t2p:mt.t2p,score1:s1,score2:s2,winner:s1>s2?'team1':'team2'});cnt++;}}if(cnt===0){alert('Enter scores!');return;}if(editIdx!==null){data.weeks[editIdx]={date:curr.date,court1:curr.court1,court2:curr.court2,teams:curr.teams,matches:wm};recalc();alert('‚úÖ Updated!');editIdx=null;}else{data.weeks.push({date:curr.date,court1:curr.court1,court2:curr.court2,teams:curr.teams,matches:wm});for(var i=0;i<wm.length;i++){var m=wm[i];updPS(m.t1p[0],m.score1,m.score2);updPS(m.t1p[1],m.score1,m.score2);updPS(m.t2p[0],m.score2,m.score1);updPS(m.t2p[1],m.score2,m.score1);}alert('‚úÖ Saved!');}save();curr=null;updLB();updHist();switchTab('leaderboard');}
        function updPS(n,ts,os){if(!data.players[n])data.players[n]={matches:0,wins:0,points:0};data.players[n].matches++;data.players[n].points+=ts;if(ts>os)data.players[n].wins++;}
        function updLB(){var c=document.getElementById('lbCont');if(Object.keys(data.players).length===0){c.innerHTML='<div class="leaderboard-item header"><div class="rank">Rank</div><div class="player-name">Player</div><div class="stat">Matches</div><div class="stat">Wins</div><div class="stat">Points</div><div class="stat">Pts/Match</div></div><div class="empty-state"><h3>No data</h3></div>';return;}var sp=Object.entries(data.players).sort(function(a,b){return b[1].points-a[1].points;}),h='<div class="leaderboard-item header"><div class="rank">Rank</div><div class="player-name">Player</div><div class="stat">Matches</div><div class="stat">Wins</div><div class="stat">Points</div><div class="stat">Pts/Match</div></div>';for(var i=0;i<sp.length;i++){var n=sp[i][0],s=sp[i][1],r=i+1,rc='';if(r===1)rc='gold';else if(r===2)rc='silver';else if(r===3)rc='bronze';var pm=(s.points/s.matches).toFixed(1);h+='<div class="leaderboard-item"><div class="rank '+rc+'">'+r+'</div><div class="player-name">'+n+'</div><div class="stat">'+s.matches+'</div><div class="stat">'+s.wins+'</div><div class="stat">'+s.points+'</div><div class="stat">'+pm+'</div></div>';}c.innerHTML=h;}
        function exportCSV(){if(Object.keys(data.players).length===0){alert('No data!');return;}var sp=Object.entries(data.players).sort(function(a,b){return b[1].points-a[1].points;}),csv='Rank,Player,Matches,Wins,Points,Pts/Match\\n';for(var i=0;i<sp.length;i++){var n=sp[i][0],s=sp[i][1],pm=(s.points/s.matches).toFixed(1);csv+=(i+1)+',"'+n+'",'+s.matches+','+s.wins+','+s.points+','+pm+'\\n';}var b=new Blob([csv],{type:'text/csv'}),dt=new Date().toISOString().split('T')[0];window.fs.downloadFile(b,'badminton-'+dt+'.csv');}
        function copyClip(){if(Object.keys(data.players).length===0){alert('No data!');return;}var sp=Object.entries(data.players).sort(function(a,b){return b[1].points-a[1].points;}),t='üè∏ BADMINTON LEAGUE - Spring 2026\\n\\nRank | Player | Matches | Wins | Points | Pts/Match\\n------|--------|---------|------|--------|----------\\n';for(var i=0;i<sp.length;i++){var n=sp[i][0],s=sp[i][1],r=i+1,m=r===1?'ü•á':r===2?'ü•à':r===3?'ü•â':'  ',pm=(s.points/s.matches).toFixed(1);t+=m+' '+r+' | '+n+' | '+s.matches+' | '+s.wins+' | '+s.points+' | '+pm+'\\n';}navigator.clipboard.writeText(t).then(function(){alert('‚úÖ Copied!');}).catch(function(){alert('‚ùå Failed!');});}
        function updHist(){var c=document.getElementById('histCont');if(data.weeks.length===0){c.innerHTML='<div class="empty-state"><h3>No history</h3></div>';return;}var sw=data.weeks.map(function(w,i){return{week:w,idx:i};}).sort(function(a,b){return new Date(b.week.date)-new Date(a.week.date);}),h='';for(var w=0;w<sw.length;w++){var wk=sw[w].week,oi=sw[w].idx,dt=new Date(wk.date).toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'});h+='<div class="week-section"><div class="week-header"><h3>Week '+(data.weeks.length-w)+' - '+dt+'</h3><div class="week-actions"><button class="btn btn-warning btn-sm" onclick="editWeek('+oi+')">‚úèÔ∏è Edit</button><button class="btn btn-danger btn-sm" onclick="delWeek('+oi+')">üóëÔ∏è Delete</button></div></div><p><strong>Teams:</strong> '+wk.teams.map(function(t){return t.name;}).join(', ')+'</p><p><strong>Matches:</strong> '+wk.matches.length+' of 18</p></div>';}c.innerHTML=h;}
        load();
    </script>
</body>
</html>
